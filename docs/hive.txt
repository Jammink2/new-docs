# The Hive (SQL-style) Query Language

This guide covers the basics of the Hive query language: a SQL-like query language.

## Prerequisites

  * Basic knowledge of Treasure Data, including the latest installed version of [the toolbelt](http://toolbelt.treasure-data.com).

## About Apache Hive

The Hive query language (HiveQL) is the primary data processing method for Treasure Data. HiveQL is powered by [Apache Hive](http://hive.apache.org/).

NOTE: Users can only issue "SELECT" statements. All other types of statements (ex: Data Definition Statements, Data Manipulation Statements, etc.) are not allowed.

## Tutorial

The official Hive tutorial explains the basic functionality of HiveQL.

* [Hive Tutorial](https://cwiki.apache.org/confluence/display/Hive/Tutorial)

## Reference

The official language manual can be found here:

* [HiveQL Language Manual](https://cwiki.apache.org/confluence/display/Hive/LanguageManual)

## Example Queries

Here are some queries that you could run on logs consisting of the fields: ip, url, and time.

#### Number of Records

    :::sql
    SELECT COUNT(1) FROM www_access;

#### Number of Unique IPs

    :::sql
    SELECT COUNT(distinct v['ip']) FROM www_access;

#### Number of Unique IPs that Accessed the Top Page

    :::sql
    SELECT COUNT(distinct v['ip']) FROM www_access \
      WHERE v['url']='/';

#### Number of Accesses per Unique IP

    :::sql
    SELECT v['ip'], COUNT(*) FROM www_access \
      GROUP BY v['ip'] LIMIT 30;

#### Unique IPs Sorted by Number of Accesses

    :::sql
    SELECT v['ip'], COUNT(*) AS cnt FROM www_access \
      GROUP BY v['ip']
      ORDER BY cnt DESC LIMIT 30;

#### Number of Accesses After a Certain Time

    :::sql
    SELECT COUNT(*) FROM www_access \
      WHERE time >= unix_timestamp('2011-08-19 00:00:00');

NOTE: The 'time' column is a special column that stores the UNIX timestamp of the log.

#### Number of Accesses Each Hour

    :::sql
    SELECT from_unixtime(CAST(time/(60*60*24) AS INT)*60*60*24) AS day, \
      COUNT(*) FROM www_access \
      GROUP BY CAST(time/(60*60*24) AS INT);
