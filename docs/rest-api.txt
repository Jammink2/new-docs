# REST API

The user can control Treasure Data using the public REST API.

This article will explain how to use the public REST API.

## Prerequisites

  * Basic knowledge of Treasure Data, including [the toolbelt](http://toolbelt.treasure-data.com).
  * A table with some data. You can find an example in the [Getting Started](quickstart) guide.
  * Basic knowledge of our [query language](hive).

## Endpoint

All API requests should be sent to *api.treasure-data.com*.

## Authorization

Every request to Treasure Data must contain *authentication information*, provided by the special 'AUTHORIZATION' HTTP headers. The header format is as follows:

    :::term
    "AUTHORIZATION: TD1 " + YourApiKeyHere

The API key is your authentication key. The API key can be found in your ~/.td/td.conf file.

    :::term
    $ grep apikey ~/.td/td.conf
    apikey = 1be3de7d01be3de7d01be3de7d01be3de7d01be3

The request looks like this when using the curl command. (The -H option adds the AUTHORIZATION HTTP header to the request)

    :::term
    $ curl -H "AUTHORIZATION: TD1 YourApiKeyHere" \
      "http://api.treasure-data.com/v3/job/result/2162"

## Limitation

The extraordinaly API abuse could be limited, but for now, no specific limitation is imposed for REST API calls.

## GET /v3/database/list
This command returns a list of your databases.

#### Parameters
No parameters are required.

#### Output
* **databases**: an array of your databases

#### Example Result
    :::term
    {
      "databases": [
        { "name": "db0" },
        { "name": "db1" }
      ]
    }

## GET /v3/table/list/:database
This command returns a list of your tables.

#### Parameters
* **database**: the name of the database

#### Output
* **database**: the name of the database
* **tables**: an array of your tables within the database

#### Example Result
    :::term
    {
      "database": "db0",
      "tables": [
        {
          "name": "access_log",
          "count": 13123233
        },
        {
          "name": "payment_log",
          "count": 331232
        }
      ]
    }

## POST /v3/job/issue/hive/:database
This command issues queries.

#### Parameters
* **database**: the name of the database
* **query**: the query string

#### Output
* **database**: the name of the database
* **job_id**: the name of the table created

#### Example Result
    :::term
    {
      "job_id": "12345"
      "type": "hive",
      "database": "www_access",
      "url": "http://console.treasure-data.com/will-be-ready"
    }

## GET /v3/job/show/:job_id
This command shows the status of a specific job.

#### Parameters
* **job_id**: the specified job_id

#### Output
* **job_id**: the specified job_id
* **type**: the job type (only 'hive' at the moment)
* **query**: the query
* **database**: the name of the database
* **status**: the job status. The status can be 'queued', 'booting', 'running', 'success', or 'error'
* **created_at**: the job creation time
* **updated_at**: the latest job update time

#### Examples
    :::term
    {
      "type": "hive",
      "query": "SELECT * FROM ACCESS",
      "job_id": "12345",
      "status": "success",
      "url": "http://console.treasure-data.com/jobs/12345",
      "created_at":"Sun Jun 26 17:39:18 -0400 2011",
      "updated_at":"Sun Jun 26 17:39:54 -0400 2011"
    }

## GET /v3/job/result/:job_id?format=tsv
This command returns the result of a specific job. Before issuing this command, please confirm that the job has been completed successfully via the /v3/job/show/:job_id command.

#### Parameters
* **job_id**: the specified job_id
* **format**: the result format: 'tsv', 'csv', or 'json'.

#### Output
* the result in the specified format.

#### Example Result

    :::term
    # URL: http://api.treasure-data.com/v3/job/result/2162?format=tsv
    aaaa    bbbb    cccc
    aaaa    bbbb    cccc
    aaaa    bbbb    cccc
    aaaa    bbbb    cccc
    aaaa    bbbb    cccc

&nbsp;

    :::term
    # URL: http://api.treasure-data.com/v3/job/result/2162?format=csv
    aaaa,bbbb,cccc
    aaaa,bbbb,cccc
    aaaa,bbbb,cccc
    aaaa,bbbb,cccc
    aaaa,bbbb,cccc

&nbsp;

    :::term
    # URL: http://api.treasure-data.com/v3/job/result/2162?format=json
    [
      [aaaa,bbbb,cccc],
      [aaaa,bbbb,cccc],
      [aaaa,bbbb,cccc],
      [aaaa,bbbb,cccc],
      [aaaa,bbbb,cccc]
    ]

## Libraries

There are several wrapper libraries for the REST API. The following libraries are developed by Treasure Data, Inc:

* [Ruby Library for Treasure Data REST API](rest-api-ruby-client)
* [Java Library for Treasure Data REST API](https://github.com/treasure-data/td-client-java)
  * TreasureData's [JDBC Driver](jdbc-driver) is also available.

3rd party developers are also actively developing language bindings:

* [PHP Library for Treasure Data REST API](https://github.com/crocos/php-treasure-data)
